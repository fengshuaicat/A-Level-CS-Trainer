<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Silicon Tycoon - A-Level Edition</title>
    <style>
        :root {
            --primary: #00f3ff; /* Cyber Blue */
            --secondary: #bc13fe; /* Cyber Purple */
            --bg: #050510;
            --panel: #121225;
        }
        body {
            font-family: 'Segoe UI', sans-serif;
            background: var(--bg);
            color: white;
            margin: 0;
            height: 100vh;
            overflow: hidden;
            display: flex;
        }
        
        /* 左侧：服务器机房 (视觉区) */
        .server-room {
            flex: 1;
            position: relative;
            background: radial-gradient(circle at center, #1a1a3a 0%, #000 100%);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            border-right: 2px solid #333;
        }

        .server-rack {
            width: 200px;
            background: #222;
            border: 4px solid #444;
            border-radius: 10px;
            padding: 10px;
            display: flex;
            flex-direction: column;
            gap: 5px;
            box-shadow: 0 0 30px rgba(0, 243, 255, 0.1);
            transition: 0.3s;
        }
        
        .server-unit {
            height: 15px;
            background: #111;
            border-radius: 2px;
            position: relative;
            overflow: hidden;
        }
        /* 闪烁灯光动画 */
        .server-unit::after {
            content: '';
            position: absolute;
            top: 2px; right: 5px;
            width: 6px; height: 6px;
            background: #333;
            border-radius: 50%;
            animation: blink 1s infinite;
        }
        .server-unit.active::after { background: var(--primary); animation-duration: 0.2s; }
        
        @keyframes blink { 0%, 100% { opacity: 0.3; } 50% { opacity: 1; } }

        .stats-display {
            margin-top: 30px;
            text-align: center;
        }
        .hash-rate { font-size: 3rem; color: var(--primary); font-weight: bold; text-shadow: 0 0 15px var(--primary); }
        .currency-label { font-size: 1rem; color: #888; letter-spacing: 2px; }

        /* 右侧：控制台 (升级与题目) */
        .control-panel {
            width: 350px;
            background: var(--panel);
            padding: 20px;
            display: flex;
            flex-direction: column;
            overflow-y: auto;
        }

        h2 { border-bottom: 1px solid #444; padding-bottom: 10px; color: var(--secondary); }

        .upgrade-item {
            background: #1e1e30;
            margin-bottom: 15px;
            padding: 15px;
            border-radius: 8px;
            cursor: pointer;
            transition: 0.2s;
            border: 1px solid #333;
            display: flex;
            justify-content: space-between;
            align-items: center;
            opacity: 0.7;
        }
        
        .upgrade-item:hover { transform: translateX(-5px); border-color: var(--primary); opacity: 1; }
        .upgrade-item.disabled { filter: grayscale(1); cursor: not-allowed; opacity: 0.4; }

        .upgrade-info h4 { margin: 0 0 5px 0; }
        .upgrade-info p { margin: 0; font-size: 0.8rem; color: #aaa; }
        .cost { color: #ffd700; font-weight: bold; }

        /* 突发事件弹窗 */
        .event-overlay {
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.9);
            z-index: 100;
            display: none;
            justify-content: center;
            align-items: center;
            flex-direction: column;
        }
        
        .event-box {
            background: #222;
            border: 2px solid var(--alert-color, red);
            padding: 30px;
            border-radius: 10px;
            width: 500px;
            text-align: center;
            box-shadow: 0 0 50px rgba(255,0,0,0.3);
        }

        .event-box h2 { color: white; border: none; }
        .question-text { font-size: 1.2rem; margin: 20px 0; line-height: 1.5; }
        .options { display: grid; gap: 10px; }
        .opt-btn { padding: 15px; background: #333; border: none; color: white; cursor: pointer; font-size: 1rem; transition: 0.2s; }
        .opt-btn:hover { background: var(--primary); color: black; }

    </style>
</head>
<body>

    <div class="server-room">
        <div class="server-rack" id="rack">
            <div class="server-unit active"></div>
            <div class="server-unit active"></div>
            <div class="server-unit active"></div>
        </div>

        <div class="stats-display">
            <div class="hash-rate" id="money">0</div>
            <div class="currency-label">DATA HASHES (BITS)</div>
            <div style="margin-top:10px; color:#aaa;">Rate: <span id="rate">1</span> bits/sec</div>
        </div>
    </div>

    <div class="control-panel">
        <h2>SYSTEM UPGRADES</h2>
        <div id="shop-list">
            </div>
        
        <div style="margin-top: auto; padding-top: 20px; font-size: 0.8rem; color: #666; text-align: center;">
            Upgrade requires <span style="color:#ffd700">Bits</span> + <span style="color:var(--primary)">Knowledge</span>
        </div>
    </div>

    <div class="event-overlay" id="quiz-modal">
        <div class="event-box">
            <h2 style="color: #ff4757;">SYSTEM ALERT</h2>
            <p>To install this upgrade, verify security protocol:</p>
            <div class="question-text" id="q-text">Question?</div>
            <div class="options" id="q-options"></div>
        </div>
    </div>

<script>
    // === 游戏数据 ===
    let bits = 0;
    let bitsPerSecond = 1;
    let lastUpdate = Date.now();
    
    // 升级配置 (关联知识点)
    const upgrades = [
        { id: 'ram', name: 'DDR4 RAM Expansion', desc: 'Increase buffer speed.', baseCost: 50, rateIncrease: 5, qTag: 'hardware', count: 0 },
        { id: 'gpu', name: 'GPU Cluster', desc: 'Parallel processing power.', baseCost: 200, rateIncrease: 20, qTag: 'logic', count: 0 },
        { id: 'fiber', name: 'Fiber Optic Line', desc: 'High bandwidth connection.', baseCost: 1000, rateIncrease: 100, qTag: 'network', count: 0 },
        { id: 'ai', name: 'Neural Network AI', desc: 'Automated optimization.', baseCost: 5000, rateIncrease: 500, qTag: 'ai', count: 0 }
    ];

    // 简易题库 (实际可从 JSON 加载)
    const questionBank = {
        'hardware': [
            { q: "Which memory is volatile?", options: ["RAM", "ROM", "HDD", "SSD"], a: "RAM" },
            { q: "What is the role of the ALU?", options: ["Calculations", "Storage", "Cooling", "Input"], a: "Calculations" }
        ],
        'logic': [
            { q: "XOR Gate: 1 XOR 1 = ?", options: ["0", "1", "True", "Null"], a: "0" },
            { q: "NOT(A AND B) is same as?", options: ["NOT A OR NOT B", "NOT A AND NOT B", "A OR B", "A NAND B"], a: "NOT A OR NOT B" }
        ],
        'network': [
            { q: "IP Address identifies...", options: ["Device on network", "MAC Address", "User Name", "Website URL"], a: "Device on network" },
            { q: "Protocol for secure web?", options: ["HTTPS", "HTTP", "FTP", "SMTP"], a: "HTTPS" }
        ],
        'ai': [
            { q: "AI learning from labeled data is...", options: ["Supervised", "Unsupervised", "Reinforcement", "Deep"], a: "Supervised" }
        ]
    };

    // === 核心循环 ===
    function gameLoop() {
        const now = Date.now();
        const dt = (now - lastUpdate) / 1000;
        lastUpdate = now;

        bits += bitsPerSecond * dt;
        updateDisplay();
        checkUpgradeAvailability();

        requestAnimationFrame(gameLoop);
    }

    function updateDisplay() {
        document.getElementById('money').innerText = Math.floor(bits).toLocaleString();
        document.getElementById('rate').innerText = bitsPerSecond;
        
        // 动态增加服务器机架的视觉效果
        const rack = document.getElementById('rack');
        const neededUnits = Math.min(20, 3 + Math.floor(bitsPerSecond / 10));
        if (rack.children.length < neededUnits) {
            const div = document.createElement('div');
            div.className = 'server-unit active';
            rack.appendChild(div);
        }
    }

    // === 商店逻辑 ===
    function renderShop() {
        const list = document.getElementById('shop-list');
        list.innerHTML = '';
        upgrades.forEach((u, index) => {
            const cost = Math.floor(u.baseCost * Math.pow(1.2, u.count));
            const item = document.createElement('div');
            item.className = 'upgrade-item disabled';
            item.id = `upg-${index}`;
            item.innerHTML = `
                <div class="upgrade-info">
                    <h4>${u.name} <span style="font-size:0.8em; color:var(--primary)">Lv.${u.count}</span></h4>
                    <p>${u.desc} (+${u.rateIncrease}/s)</p>
                </div>
                <div class="cost">${cost} Bits</div>
            `;
            item.onclick = () => tryBuyUpgrade(index);
            list.appendChild(item);
        });
    }

    function checkUpgradeAvailability() {
        upgrades.forEach((u, index) => {
            const cost = Math.floor(u.baseCost * Math.pow(1.2, u.count));
            const el = document.getElementById(`upg-${index}`);
            if (bits >= cost) {
                el.classList.remove('disabled');
            } else {
                el.classList.add('disabled');
            }
        });
    }

    let pendingUpgradeIndex = -1;

    function tryBuyUpgrade(index) {
        const u = upgrades[index];
        const cost = Math.floor(u.baseCost * Math.pow(1.2, u.count));
        
        if (bits >= cost) {
            // 触发题目挑战！
            pendingUpgradeIndex = index;
            triggerQuiz(u.qTag);
        }
    }

    // === 题目逻辑 ===
    function triggerQuiz(tag) {
        const modal = document.getElementById('quiz-modal');
        const qText = document.getElementById('q-text');
        const qOpts = document.getElementById('q-options');
        
        // 随机选题
        const questions = questionBank[tag] || questionBank['hardware'];
        const q = questions[Math.floor(Math.random() * questions.length)];
        
        qText.innerText = q.q;
        qOpts.innerHTML = '';
        
        // 打乱选项
        [...q.options].sort(()=>Math.random()-0.5).forEach(opt => {
            const btn = document.createElement('button');
            btn.className = 'opt-btn';
            btn.innerText = opt;
            btn.onclick = () => checkAnswer(opt, q.a);
            qOpts.appendChild(btn);
        });

        modal.style.display = 'flex';
        // 暂停加钱？其实放置类游戏一般不暂停，让你边做题边攒钱
    }

    function checkAnswer(selected, correct) {
        const modal = document.getElementById('quiz-modal');
        modal.style.display = 'none';

        if (selected === correct) {
            // 答对：购买成功
            const u = upgrades[pendingUpgradeIndex];
            const cost = Math.floor(u.baseCost * Math.pow(1.2, u.count));
            bits -= cost;
            u.count++;
            bitsPerSecond += u.rateIncrease;
            renderShop(); // 刷新价格
        } else {
            // 答错：购买失败，不扣钱，但会有惩罚提示
            alert("Authentication Failed! Upgrade Denied.");
        }
    }

    // 启动
    renderShop();
    requestAnimationFrame(gameLoop);

</script>
</body>
</html>